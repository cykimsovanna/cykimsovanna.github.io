---
title: "Knowledge Mining Assignment 2"
format: html
---

### 1. Practicing Basic R Programming

-   [Lab01](Lab01.qmd)
-   [Lab02](Lab02.qmd)

### 2. Running an EDA on Taiwan 2016 Election

```{r}
library(haven) 
TEDS_2016 <- read_stata("https://github.com/datageneration/home/blob/master/DataProgramming/data/TEDS_2016.dta?raw=true")

TEDS_2016$PartyID <- factor(TEDS_2016$PartyID, labels=c("KMT","DPP","NP","PFP", "TSU", "NPP","NA"))
attach(TEDS_2016)
```

```{r}
head(PartyID)
tail(PartyID)

library(descr)
freq(TEDS_2016$PartyID)

library(ggplot2)
ggplot(TEDS_2016, aes(PartyID)) + 
  geom_bar()

ggplot(TEDS_2016, aes(PartyID)) + 
  geom_bar(aes(y = (after_stat(count))/sum(after_stat(count)), fill=PartyID)) + 
  scale_y_continuous(labels=scales::percent) +
  ylab("Party Support (%)") + 
  xlab("Taiwan Political Parties") +
  theme_bw() +
  scale_fill_manual(values=c("steelblue","forestgreen", "khaki1","orange","goldenrod","yellow","grey"))
```

```{r}
library(tidyverse)
TEDS_2016 %>% 
  count(PartyID) %>% 
  mutate(perc = n / nrow(TEDS_2016)) -> T2
ggplot(T2, aes(x = reorder(PartyID, -perc),y = perc,fill=PartyID)) + 
  geom_bar(stat = "identity") +
  ylab("Party Support (%)") + 
  xlab("Taiwan Political Parties") +
  theme_bw() +
  scale_fill_manual(values=c("steel blue","forestgreen","khaki1","orange","goldenrod","yellow","grey"))
```

#### 2.1. What problems did I encounter when working with the dataset?

-   The only problems I ran into when running the EDA was that copying and pasting from the Assignment 2 sheet does not work, so I had to do so directly from the website.

#### 2.2. How to deal with null values?

-   I would have to use the bottom codes to get rid of them. I am unsure if all values in "NA" should be considered as null values, so I just leave them be. I also remade the graph with the new version.

```{r}
unique(TEDS_2016$PartyID)
summary(TEDS_2016$PartyID)

TEDS_2016 <- na.omit(TEDS_2016)

TEDS_2016 %>% 
  count(PartyID) %>% 
  mutate(perc = n / nrow(TEDS_2016)) -> T2
ggplot(T2, aes(x = reorder(PartyID, -perc),y = perc,fill=PartyID)) + 
  geom_bar(stat = "identity") +
  ylab("Party Support (%)") + 
  xlab("Taiwan Political Parties") +
  theme_bw() +
  scale_fill_manual(values=c("steel blue","forestgreen","khaki1","orange","goldenrod","yellow","grey"))
```

#### 2.3. Exploring the relationship between `Tondu` and other variables

##### Finding Correlations

```{r}
cor(TEDS_2016$Tondu, TEDS_2016$age) 
cor(TEDS_2016$Tondu, TEDS_2016$income)
cor(TEDS_2016$Tondu, TEDS_2016$edu) 
cor(TEDS_2016$Tondu, TEDS_2016$Econ_worse)

# Because there are some missing values here, I had to make some changes to the code.
cor(TEDS_2016$Tondu, TEDS_2016$age, use="complete.obs") 
cor(TEDS_2016$Tondu, TEDS_2016$income, use="complete.obs")
cor(TEDS_2016$Tondu, TEDS_2016$edu, use="complete.obs") 
cor(TEDS_2016$Tondu, TEDS_2016$Econ_worse, use="complete.obs")

library(corrplot)
correlation_heatmap <- TEDS_2016[, c("Tondu", "age", "income", "edu", "Econ_worse")]
corr_matrix <- cor(correlation_heatmap, use = "complete.obs")
corrplot(corr_matrix, method = "circle")
```

##### Regressing `Tondu`

```{r}
lm_tondu <- lm(Tondu ~ female + DPP + age + income + edu + Taiwanese + Econ_worse, data = TEDS_2016)
summary(lm_tondu)
```

#### 2.4. Exploring the relationship between `votesai` and other variables

```{r}
ggplot(TEDS_2016, aes(x = votetsai)) +
  geom_bar() +
  labs(title = "Vote for Tsai Ing-wen", x = "Vote Tsai Ing-wen", y = "Frequency")

ggplot(TEDS_2016, aes(x = votetsai, y = age)) +
  geom_boxplot() +
  labs(title = "Age vs. Vote for Tsai Ing-wen", x = "Vote Tsai Ing-wen", y = "Age")

cor(TEDS_2016$income, as.numeric(TEDS_2016$votetsai))

glm_model_tsai <- glm(votetsai ~ age + female + income + edu + Taiwanese + Econ_worse, data = TEDS_2016, family = binomial)

summary(glm_model_tsai)


```

#### 2.4. Generating frequency table and barchart of the `Tondu` variable

```{r}
TEDS_2016$Tondu<-as.numeric(TEDS_2016$Tondu,labels=c("Unification now”, 
“Status quo, unif. in future”, “Status quo, decide later", "Status quo 
forever", "Status quo, indep. in future", "Independence now”, “No response"))

table(TEDS_2016$Tondu)
library(ggplot2)
ggplot(TEDS_2016, aes(x = Tondu)) + geom_bar(fill = "blue") + labs(title = "Distribution of Tondu Preferences", x = "Tondu", y = "Frequency")
```
